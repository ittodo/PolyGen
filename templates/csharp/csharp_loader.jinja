{# This is a Jinja2 template for generating a C# data loader class. #}
// Auto-generated by Polygen. Do not edit.
using System;
using System.Collections.Generic;
using System.Globalization;
using Polygen.Common;

namespace {{ namespace }};

public static class {{ table.name }}Loader
{
    /// <summary>
    /// Loads a list of {{ table.name }} from the specified data source file.
    /// </summary>
    /// <param name="filePath">The path to the data source file (e.g., a .csv file).</param>
    /// <returns>A list of {{ table.name }} instances.</returns>
    public static List<{{ table.name }}> Load(string filePath)
    {
        var reader = DataSourceFactory.CreateReader(filePath);
        var list = new List<{{ table.name }}>();

        foreach (var row in reader.ReadRows())
        {
            var item = new {{ table.name }}
            {
{% for field in table.fields %}
                {% if field.field_type | map_type(lang) | starts_with("System.Collections.Generic.List<") %}
                {{ field.name }} = DataSourceFactory.ConvertListValue<{{ field.field_type | map_type(lang) | replace("System.Collections.Generic.List<", "") | replace(">", "") }}>(row, "{{ field.name }}"),
                {% else %}
                {{ field.name }} = DataSourceFactory.ConvertSingleValue<{{ field.field_type | map_type(lang) }}>(row, "{{ field.name }}"),
                {% endif %}
{% endfor %}
            };
            list.Add(item);
        }

        return list;
    }

    }
