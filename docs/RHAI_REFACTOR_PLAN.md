# Rhai ëª¨ë“ˆ ë¦¬íŒ©í† ë§ ê³„íš

## ê°œë… ì •ë¦¬

PolyGenì˜ ì½”ë“œ ìƒì„±ì€ ë‘ ê°€ì§€ ì£¼ìš” ì˜ì—­ìœ¼ë¡œ ë‚˜ë‰©ë‹ˆë‹¤:

### 1. í´ë˜ìŠ¤ ìƒì„± (Entity/DTO)
ìŠ¤í‚¤ë§ˆì˜ í…Œì´ë¸”/ì—´ê±°í˜•ì„ ëŒ€ìƒ ì–¸ì–´ì˜ í´ë˜ìŠ¤/êµ¬ì¡°ì²´ë¡œ ë³€í™˜
- C#: `csharp_file.rhai` â†’ `.cs` íŒŒì¼
- ì¶”í›„: TypeScript, Rust ë“±

### 2. ë¡œë” ìƒì„± (Data Loaders)
ì›ì‹œ ë°ì´í„°(CSV, JSON, Binary)ë¥¼ í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ë¡œ ë³€í™˜í•˜ëŠ” ì½”ë“œ ìƒì„±
- **CSV ë¡œë”**: CSV íŒŒì¼ â†’ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤
- **JSON ë¡œë”**: JSON íŒŒì¼ â†’ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤
- **Binary ë¡œë”**: ë°”ì´ë„ˆë¦¬ ë°ì´í„° â†” ê°ì²´ ì¸ìŠ¤í„´ìŠ¤

---

## í˜„ì¬ êµ¬ì¡° ë¶„ì„

### src/rhai/ (1936ì¤„)
```
src/rhai/
â”œâ”€â”€ mod.rs (7ì¤„) - ëª¨ë“ˆ ì„ ì–¸
â”œâ”€â”€ registry.rs (365ì¤„) - IR íƒ€ì… ë“±ë¡ + ê³µí†µ í—¬í¼
â”œâ”€â”€ csharp.rs (92ì¤„) - C# CSV í—¬í¼ (2ê°œ í•¨ìˆ˜)
â””â”€â”€ csv.rs (1472ì¤„) - CSV ë¡œë” ì „ì²´ âš ï¸ ë„ˆë¬´ í¼
```

### templates/csharp/ í…œí”Œë¦¿ êµ¬ì¡°
```
templates/csharp/
â”œâ”€â”€ csharp_file.rhai              # í´ë˜ìŠ¤ ìƒì„± ì§„ì…ì 
â”œâ”€â”€ csharp_namespace.rhai         # ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì²˜ë¦¬
â”œâ”€â”€ enum/                         # ì—´ê±°í˜• í…œí”Œë¦¿
â”œâ”€â”€ struct/                       # í´ë˜ìŠ¤ í…œí”Œë¦¿
â”‚
â”œâ”€â”€ csharp_csv_mappers_file.rhai  # CSV ë¡œë” ì§„ì…ì 
â”œâ”€â”€ csharp_csv_columns_file.rhai  # CSV ì»¬ëŸ¼ ì •ì˜
â”‚
â”œâ”€â”€ csharp_json_mappers_file.rhai # JSON ë¡œë” ì§„ì…ì 
â”‚
â”œâ”€â”€ csharp_binary_readers_file.rhai # Binary ë¡œë” (ì½ê¸°)
â””â”€â”€ csharp_binary_writers_file.rhai # Binary ë¡œë” (ì“°ê¸°)
```

### csv.rs ë‚´ë¶€ ê¸°ëŠ¥ ë¶„ì„
| ì¤„ ë²”ìœ„ | ê¸°ëŠ¥ | ì—­í•  |
|---------|------|------|
| 16-111 | `register_csv()` | Rhai í•¨ìˆ˜ ë“±ë¡ |
| 112-304 | IR íƒìƒ‰ ìœ í‹¸ | find_struct, resolve_enum |
| 305-463 | ë„¤ì„ìŠ¤í˜ì´ìŠ¤ í•´ê²° | resolve_struct_with_ns |
| 464-578 | CSV ì»¬ëŸ¼ | ì»¬ëŸ¼ í—¤ë” ìˆ˜ì§‘ |
| 579-622 | C# íƒ€ì… ë§¤í•‘ | map_cs_primitive |
| 623-952 | CSV ì½ê¸° ìƒì„± | ì¸ë±ìŠ¤/ë”•ì…”ë„ˆë¦¬ ê¸°ë°˜ |
| 953-ë | CSV ì“°ê¸° ìƒì„± | ì“°ê¸° ì½”ë“œ |

---

## ë¦¬íŒ©í† ë§ ëª©í‘œ

1. **ëª…í™•í•œ ë¶„ë¦¬**: í´ë˜ìŠ¤ ìƒì„± vs ë¡œë” ìƒì„±
2. **ë¡œë” í™•ì¥ì„±**: CSV, JSON, Binary ë¡œë”ë¥¼ ì¼ê´€ëœ êµ¬ì¡°ë¡œ
3. **ì–¸ì–´ í™•ì¥ì„±**: C# ì™¸ ë‹¤ë¥¸ ì–¸ì–´ ì§€ì› ìš©ì´
4. **í…ŒìŠ¤íŠ¸ ìš©ì´ì„±**: ê° ëª¨ë“ˆ ë…ë¦½ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥

---

## ì œì•ˆ êµ¬ì¡°

```
src/rhai/
â”œâ”€â”€ mod.rs                  # ëª¨ë“ˆ ì„ ì–¸ ë° re-exports
â”œâ”€â”€ registry.rs             # IR íƒ€ì… ë“±ë¡ (ìœ ì§€)
â”‚
â”œâ”€â”€ common/                 # ê³µí†µ ìœ í‹¸ë¦¬í‹°
â”‚   â”œâ”€â”€ mod.rs
â”‚   â””â”€â”€ ir_lookup.rs        # find_struct, resolve_enum ë“±
â”‚
â””â”€â”€ csharp/                 # C# ì½”ë“œ ìƒì„±
    â”œâ”€â”€ mod.rs              # register_csharp_all()
    â”œâ”€â”€ type_mapping.rs     # C# íƒ€ì… ë§¤í•‘
    â”‚
    â””â”€â”€ loaders/            # ë¡œë” ìƒì„±
        â”œâ”€â”€ mod.rs
        â”œâ”€â”€ csv.rs          # CSV ë¡œë” (columns + readers + writers)
        â”œâ”€â”€ json.rs         # JSON ë¡œë” (í–¥í›„)
        â””â”€â”€ binary.rs       # Binary ë¡œë” (í–¥í›„)
```

---

## ì‘ì—… ìˆœì„œ

### Phase 1: ê³µí†µ ìœ í‹¸ë¦¬í‹° ë¶„ë¦¬
1. `src/rhai/common/mod.rs` ìƒì„±
2. `src/rhai/common/ir_lookup.rs` - IR íƒìƒ‰ í•¨ìˆ˜ ì´ë™
   - `find_struct_in_ns`, `find_enum_in_ns`
   - `find_struct_in_tree`, `find_enum_in_tree`
   - `resolve_struct`, `resolve_enum`
   - `any_struct_named`, `any_enum_named`
3. ê¸°ì¡´ csv.rsì—ì„œ import ë³€ê²½

### Phase 2: C# ë¡œë” ëª¨ë“ˆ ì¬êµ¬ì„±
1. `src/rhai/csharp/mod.rs` ìƒì„± - `register_csharp_all()`
2. `src/rhai/csharp/type_mapping.rs` - C# íƒ€ì… ë§¤í•‘
   - `map_cs_primitive`, `cs_type_for`, `is_inline_enum_name`
3. `src/rhai/csharp/loaders/mod.rs` - ë¡œë” ëª¨ë“ˆ
4. `src/rhai/csharp/loaders/csv.rs` - CSV ë¡œë”
   - ì»¬ëŸ¼ ìˆ˜ì§‘, ì½ê¸°/ì“°ê¸° ì½”ë“œ ìƒì„±
5. ê¸°ì¡´ csharp.rs í†µí•©

### Phase 3: ë¬¸ì„œí™”
1. ê° ëª¨ë“ˆì— `//!` ëª¨ë“ˆ ë¬¸ì„œ ì¶”ê°€
2. ëª¨ë“  public í•¨ìˆ˜ì— `///` ë¬¸ì„œ ì¶”ê°€
3. ì£¼ìš” ê°œë…/íë¦„ ì„¤ëª… ì¶”ê°€

### Phase 4: ì •ë¦¬ ë° í…ŒìŠ¤íŠ¸
1. ê¸°ì¡´ csv.rs ì‚­ì œ
2. mod.rs ì—…ë°ì´íŠ¸
3. ê¸°ì¡´ í…ŒìŠ¤íŠ¸/ìŠ¤ëƒ…ìƒ· í…ŒìŠ¤íŠ¸ í™•ì¸

---

## ì˜ˆìƒ ê²°ê³¼

### íŒŒì¼ë³„ ì¤„ ìˆ˜ (ì˜ˆìƒ)
| íŒŒì¼ | ì˜ˆìƒ ì¤„ ìˆ˜ | ì—­í•  |
|------|------------|------|
| `common/ir_lookup.rs` | ~200 | IR êµ¬ì¡° íƒìƒ‰ |
| `csharp/type_mapping.rs` | ~100 | C# íƒ€ì… ë³€í™˜ |
| `csharp/loaders/csv.rs` | ~800 | CSV ë¡œë” ìƒì„± |

### í–¥í›„ í™•ì¥
```
src/rhai/csharp/loaders/
â”œâ”€â”€ csv.rs      # âœ… êµ¬í˜„ë¨
â”œâ”€â”€ json.rs     # ğŸ“‹ TODO: JSON ë¡œë”
â””â”€â”€ binary.rs   # ğŸ“‹ TODO: Binary ë¡œë”

src/rhai/typescript/  # ğŸ“‹ TODO: TypeScript ì§€ì›
â””â”€â”€ ...
```

---

## ì£¼ì˜ì‚¬í•­

1. **í•˜ìœ„ í˜¸í™˜ì„±**: Rhai í…œí”Œë¦¿ì—ì„œ ì‚¬ìš©í•˜ëŠ” í•¨ìˆ˜ëª… ìœ ì§€
2. **ë“±ë¡ ìˆœì„œ**: `register_*()` í•¨ìˆ˜ í˜¸ì¶œ ìˆœì„œ ìœ ì§€
3. **í…ŒìŠ¤íŠ¸**: ê° ë‹¨ê³„ë§ˆë‹¤ ê¸°ì¡´ í…ŒìŠ¤íŠ¸ í†µê³¼ í™•ì¸

---

## ì§„í–‰ ìƒí™©

| Phase | ìƒíƒœ | ë¹„ê³  |
|-------|------|------|
| Phase 1: ê³µí†µ ìœ í‹¸ë¦¬í‹° ë¶„ë¦¬ | âœ… ì™„ë£Œ | common/ir_lookup.rs ìƒì„± |
| Phase 2: C# ë¡œë” ëª¨ë“ˆ ì¬êµ¬ì„± | âœ… ì™„ë£Œ | csharp/loaders/csv.rs, csharp/type_mapping.rs ìƒì„± |
| Phase 3: ë¬¸ì„œí™” | âœ… ì™„ë£Œ | ëª¨ë“  ëª¨ë“ˆì— ë¬¸ì„œ ì¶”ê°€ |
| Phase 4: ì •ë¦¬ ë° í…ŒìŠ¤íŠ¸ | âœ… ì™„ë£Œ | ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼ |

---

## ìµœì¢… ê²°ê³¼

### ìµœì¢… íŒŒì¼ êµ¬ì¡° (2283ì¤„)
```
src/rhai/
â”œâ”€â”€ mod.rs                          (6ì¤„)   - ëª¨ë“ˆ ì„ ì–¸
â”œâ”€â”€ registry.rs                     (416ì¤„) - IR íƒ€ì… ë“±ë¡
â”œâ”€â”€ common/
â”‚   â”œâ”€â”€ mod.rs                      (28ì¤„)  - ê³µí†µ ëª¨ë“ˆ ì„ ì–¸
â”‚   â””â”€â”€ ir_lookup.rs                (444ì¤„) - IR íƒìƒ‰ ìœ í‹¸ë¦¬í‹°
â””â”€â”€ csharp/
    â”œâ”€â”€ mod.rs                      (112ì¤„) - C# ëª¨ë“ˆ + í—¬í¼
    â”œâ”€â”€ type_mapping.rs             (118ì¤„) - C# íƒ€ì… ë§¤í•‘
    â””â”€â”€ loaders/
        â”œâ”€â”€ mod.rs                  (39ì¤„)  - ë¡œë” ëª¨ë“ˆ ì„ ì–¸
        â””â”€â”€ csv.rs                  (1120ì¤„) - CSV ë¡œë” ìƒì„±
```

### ë¦¬íŒ©í† ë§ ì „í›„ ë¹„êµ
| í•­ëª© | ë¦¬íŒ©í† ë§ ì „ | ë¦¬íŒ©í† ë§ í›„ |
|------|-------------|-------------|
| íŒŒì¼ ìˆ˜ | 4ê°œ | 8ê°œ |
| ì´ ì¤„ ìˆ˜ | 1936ì¤„ | 2283ì¤„ (+18% ë¬¸ì„œí™”) |
| ê°€ì¥ í° íŒŒì¼ | csv.rs (1472ì¤„) | csv.rs (1120ì¤„) |
| ëª¨ë“ˆ ê¹Šì´ | 1ë‹¨ê³„ | 3ë‹¨ê³„ |

### ì‚­ì œëœ íŒŒì¼
- `src/rhai/csv.rs` (1472ì¤„) â†’ `csharp/loaders/csv.rs`ë¡œ ì´ë™
- `src/rhai/csharp.rs` (92ì¤„) â†’ `csharp/mod.rs`ë¡œ ì´ë™

### í…ŒìŠ¤íŠ¸ ê²°ê³¼
- 86ê°œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ í†µê³¼
- 2ê°œ ìŠ¤ëƒ…ìƒ· í…ŒìŠ¤íŠ¸ í†µê³¼
- clippy ê²½ê³  ì—†ìŒ (rhai ëª¨ë“ˆ)
- cargo doc ê²½ê³  ì—†ìŒ
