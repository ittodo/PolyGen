<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PolyGen Schema Viewer</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>PolyGen Schema Viewer</h1>
            <div class="controls">
                <button id="theme-toggle" title="Toggle dark/light mode">ğŸŒ™</button>
                <button id="load-file" title="Load .poly file">ğŸ“ íŒŒì¼ ì—´ê¸°</button>
                <input type="file" id="file-input" accept=".poly" hidden>
            </div>
        </header>

        <main>
            <div class="editor-panel">
                <div class="panel-header">
                    <span>ì…ë ¥ (.poly)</span>
                    <button id="clear-btn" title="Clear">ì§€ìš°ê¸°</button>
                </div>
                <textarea id="poly-input" placeholder=".poly ìŠ¤í‚¤ë§ˆë¥¼ ì—¬ê¸°ì— ì…ë ¥í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì„¸ìš”..."></textarea>
            </div>

            <div class="preview-panel">
                <div class="panel-header">
                    <span>ë Œë”ë§ ê²°ê³¼</span>
                    <button id="copy-btn" title="Copy HTML">HTML ë³µì‚¬</button>
                </div>
                <div id="poly-output" class="code-output"></div>
            </div>
        </main>

        <footer>
            <div class="legend">
                <span class="legend-item"><span class="sample keyword">keyword</span> í‚¤ì›Œë“œ</span>
                <span class="legend-item"><span class="sample type">type</span> íƒ€ì…</span>
                <span class="legend-item"><span class="sample annotation">@annotation</span> ì–´ë…¸í…Œì´ì…˜</span>
                <span class="legend-item"><span class="sample constraint">constraint</span> ì œì•½ì¡°ê±´</span>
                <span class="legend-item"><span class="sample string">"string"</span> ë¬¸ìì—´</span>
                <span class="legend-item"><span class="sample number">123</span> ìˆ«ì</span>
                <span class="legend-item"><span class="sample comment">// comment</span> ì£¼ì„</span>
            </div>
        </footer>
    </div>

    <script src="poly-renderer.js"></script>
    <script>
        const input = document.getElementById('poly-input');
        const output = document.getElementById('poly-output');
        const themeToggle = document.getElementById('theme-toggle');
        const loadFileBtn = document.getElementById('load-file');
        const fileInput = document.getElementById('file-input');
        const clearBtn = document.getElementById('clear-btn');
        const copyBtn = document.getElementById('copy-btn');

        // Sample schema
        const sampleSchema = `// PolyGen ìŠ¤í‚¤ë§ˆ ì˜ˆì œ
import "common.poly";

namespace game.character {

    // í”Œë ˆì´ì–´ í…Œì´ë¸”
    @load(csv: "data/players.csv", json: "data/players.json")
    @index(name)
    @index(guild_id, level)
    table Player {
        id: u32 primary_key;
        name: string max_length(100);
        level: u16 default(1) range(1, 100);
        email: string? unique;
        class: PlayerClass;
        stats: Stats;
        skills: Skill[];
    }

    // í”Œë ˆì´ì–´ í´ë˜ìŠ¤ ì—´ê±°í˜•
    enum PlayerClass {
        Warrior = 1;  // ì „ì‚¬
        Mage = 2;     // ë§ˆë²•ì‚¬
        Rogue = 3;    // ë„ì 
        Priest = 4;   // ì‚¬ì œ
    }

    // ìŠ¤íƒ¯ ì„ë² ë“œ
    embed Stats {
        hp: u32 default(100);
        mp: u32 default(50);
        attack: u32;
        defense: u32;
    }
}`;

        // Initialize with sample
        input.value = sampleSchema;
        render();

        // Render on input
        input.addEventListener('input', render);

        function render() {
            output.innerHTML = PolyRenderer.render(input.value);
        }

        // Theme toggle
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('light-theme');
            themeToggle.textContent = document.body.classList.contains('light-theme') ? 'ğŸŒ™' : 'â˜€ï¸';
        });

        // File loading
        loadFileBtn.addEventListener('click', () => fileInput.click());

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    input.value = e.target.result;
                    render();
                };
                reader.readAsText(file);
            }
        });

        // Drag and drop
        input.addEventListener('dragover', (e) => {
            e.preventDefault();
            input.classList.add('dragover');
        });

        input.addEventListener('dragleave', () => {
            input.classList.remove('dragover');
        });

        input.addEventListener('drop', (e) => {
            e.preventDefault();
            input.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.name.endsWith('.poly')) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    input.value = e.target.result;
                    render();
                };
                reader.readAsText(file);
            }
        });

        // Clear button
        clearBtn.addEventListener('click', () => {
            input.value = '';
            render();
        });

        // Copy button
        copyBtn.addEventListener('click', () => {
            const html = output.innerHTML;
            navigator.clipboard.writeText(html).then(() => {
                copyBtn.textContent = 'ë³µì‚¬ë¨!';
                setTimeout(() => copyBtn.textContent = 'HTML ë³µì‚¬', 1500);
            });
        });
    </script>
</body>
</html>
