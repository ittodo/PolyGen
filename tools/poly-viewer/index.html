<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PolyGen Schema Viewer</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>PolyGen Schema Viewer</h1>
            <div class="controls">
                <button id="theme-toggle" title="Toggle dark/light mode">ğŸŒ™</button>
                <button id="load-file" title="Load .poly file">ğŸ“ íŒŒì¼ ì—´ê¸°</button>
                <input type="file" id="file-input" accept=".poly" hidden>
            </div>
        </header>

        <main>
            <div class="editor-panel">
                <div class="panel-header">
                    <span>ì…ë ¥ (.poly)</span>
                    <button id="clear-btn" title="Clear">ì§€ìš°ê¸°</button>
                </div>
                <textarea id="poly-input" placeholder=".poly ìŠ¤í‚¤ë§ˆë¥¼ ì—¬ê¸°ì— ì…ë ¥í•˜ê±°ë‚˜ íŒŒì¼ì„ ë“œë˜ê·¸í•˜ì„¸ìš”..."></textarea>
            </div>

            <div class="preview-panel">
                <div class="panel-header">
                    <div class="tab-buttons">
                        <button id="tab-code" class="tab-btn active">ì½”ë“œ</button>
                        <button id="tab-diagram" class="tab-btn">ë‹¤ì´ì–´ê·¸ë¨</button>
                    </div>
                    <button id="copy-btn" title="Copy">ë³µì‚¬</button>
                </div>
                <div id="poly-output" class="code-output"></div>
                <div id="diagram-output" class="diagram-output" style="display: none;"></div>
            </div>
        </main>

        <footer>
            <div class="legend" id="code-legend">
                <span class="legend-item"><span class="sample keyword">keyword</span> í‚¤ì›Œë“œ</span>
                <span class="legend-item"><span class="sample type">type</span> íƒ€ì…</span>
                <span class="legend-item"><span class="sample annotation">@annotation</span> ì–´ë…¸í…Œì´ì…˜</span>
                <span class="legend-item"><span class="sample constraint">constraint</span> ì œì•½ì¡°ê±´</span>
                <span class="legend-item"><span class="sample string">"string"</span> ë¬¸ìì—´</span>
                <span class="legend-item"><span class="sample number">123</span> ìˆ«ì</span>
                <span class="legend-item"><span class="sample comment">// comment</span> ì£¼ì„</span>
            </div>
            <div class="legend" id="diagram-legend" style="display: none;">
                <span class="legend-item">ğŸ”‘ Primary Key</span>
                <span class="legend-item">ğŸ”— Foreign Key</span>
                <span class="legend-item">ğŸ“¦ Embed (inline)</span>
                <span class="legend-item"><span class="sample rel-line rel-fk-sample">â€•â†’</span> FK ê´€ê³„</span>
                <span class="legend-item"><span class="sample rel-line rel-many-sample">â€•âŸ«</span> 1:N ê´€ê³„</span>
                <span class="legend-item"><span class="sample rel-line rel-one-sample">â€•â†’</span> 1:1 ì°¸ì¡°</span>
            </div>
        </footer>
    </div>

    <script src="poly-renderer.js"></script>
    <script src="poly-diagram.js"></script>
    <script>
        const input = document.getElementById('poly-input');
        const codeOutput = document.getElementById('poly-output');
        const diagramOutput = document.getElementById('diagram-output');
        const themeToggle = document.getElementById('theme-toggle');
        const loadFileBtn = document.getElementById('load-file');
        const fileInput = document.getElementById('file-input');
        const clearBtn = document.getElementById('clear-btn');
        const copyBtn = document.getElementById('copy-btn');
        const tabCode = document.getElementById('tab-code');
        const tabDiagram = document.getElementById('tab-diagram');
        const codeLegend = document.getElementById('code-legend');
        const diagramLegend = document.getElementById('diagram-legend');

        let currentTab = 'code';

        // Sample schema
        const sampleSchema = `// PolyGen ìŠ¤í‚¤ë§ˆ ì˜ˆì œ
import "common.poly";

namespace game.character {

    // í”Œë ˆì´ì–´ í…Œì´ë¸”
    @load(csv: "data/players.csv")
    @index(name)
    @index(guild_id, level)
    table Player {
        id: u32 primary_key;
        name: string max_length(100);
        level: u16 default(1) range(1, 100);
        email: string? unique;
        class: PlayerClass;
        guild_id: u32 foreign_key(Guild.id);
        stats: Stats;
        skills: Skill[];
    }

    // ê¸¸ë“œ í…Œì´ë¸”
    table Guild {
        id: u32 primary_key;
        name: string max_length(50);
        leader_id: u32;
        created_at: string;
    }

    // ìŠ¤í‚¬ í…Œì´ë¸”
    table Skill {
        id: u32 primary_key;
        player_id: u32 foreign_key(Player.id);
        name: string;
        level: u8 default(1);
        damage: u32;
    }

    // í”Œë ˆì´ì–´ í´ë˜ìŠ¤ ì—´ê±°í˜•
    enum PlayerClass {
        Warrior = 1;
        Mage = 2;
        Rogue = 3;
        Priest = 4;
    }

    // ìŠ¤íƒ¯ ì„ë² ë“œ (ì¸ë¼ì¸ í™•ì¥)
    embed Stats {
        hp: u32 default(100);
        mp: u32 default(50);
        attack: u32;
        defense: u32;
    }
}`;

        // Initialize with sample
        input.value = sampleSchema;
        render();

        // Render on input
        input.addEventListener('input', render);

        function render() {
            // Always render both
            codeOutput.innerHTML = PolyRenderer.render(input.value);
            diagramOutput.innerHTML = PolyDiagram.render(input.value);
        }

        // Tab switching
        tabCode.addEventListener('click', () => switchTab('code'));
        tabDiagram.addEventListener('click', () => switchTab('diagram'));

        function switchTab(tab) {
            currentTab = tab;
            if (tab === 'code') {
                tabCode.classList.add('active');
                tabDiagram.classList.remove('active');
                codeOutput.style.display = 'block';
                diagramOutput.style.display = 'none';
                codeLegend.style.display = 'flex';
                diagramLegend.style.display = 'none';
                copyBtn.textContent = 'HTML ë³µì‚¬';
            } else {
                tabCode.classList.remove('active');
                tabDiagram.classList.add('active');
                codeOutput.style.display = 'none';
                diagramOutput.style.display = 'block';
                codeLegend.style.display = 'none';
                diagramLegend.style.display = 'flex';
                copyBtn.textContent = 'SVG ë³µì‚¬';
            }
        }

        // Theme toggle
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('light-theme');
            themeToggle.textContent = document.body.classList.contains('light-theme') ? 'ğŸŒ™' : 'â˜€ï¸';
        });

        // File loading
        loadFileBtn.addEventListener('click', () => fileInput.click());

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    input.value = e.target.result;
                    render();
                };
                reader.readAsText(file);
            }
        });

        // Drag and drop
        input.addEventListener('dragover', (e) => {
            e.preventDefault();
            input.classList.add('dragover');
        });

        input.addEventListener('dragleave', () => {
            input.classList.remove('dragover');
        });

        input.addEventListener('drop', (e) => {
            e.preventDefault();
            input.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.name.endsWith('.poly')) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    input.value = e.target.result;
                    render();
                };
                reader.readAsText(file);
            }
        });

        // Clear button
        clearBtn.addEventListener('click', () => {
            input.value = '';
            render();
        });

        // Copy button
        copyBtn.addEventListener('click', () => {
            const content = currentTab === 'code' ? codeOutput.innerHTML : diagramOutput.innerHTML;
            navigator.clipboard.writeText(content).then(() => {
                const originalText = copyBtn.textContent;
                copyBtn.textContent = 'ë³µì‚¬ë¨!';
                setTimeout(() => copyBtn.textContent = originalText, 1500);
            });
        });
    </script>
</body>
</html>
